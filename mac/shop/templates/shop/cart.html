{% extends 'shop/basic.html' %}

{% load static %}
{% block title%} My Cart{% endblock %}
{% block body %}
<style rel="stylesheet">
  .main_content{
    margin-left: 0px;
}
.wrapper{
  display:none;
}
</style>
<div class="row">
    <div class="col-lg-12">
        <div class="box-element">
            <a class="btn btn-outline-success" href="{% url 'ShopHome' %}">Continue Shopping </a>
             <th><a style="float:right;margin:5px;" class="btn btn-success" href="{% url 'Checkout' %}">Checkout</a> </th>
        </div>


        <br>

    {% if cart %}
        <div class="box-element">

<hr>
                {% for item in cart %}
                <div class="cart-row">
                    <div style="flex:1"><img style="width:100px;" class="row-img" src='/media/{{item.product.image}}'></div>&nbsp&nbsp
                    <div style="flex:1"><strong>{{item.product.product_name}}</strong><br>
                        {{ item.product_varient.quantity_number }} {{ item.product_varient.quantity_measure }}

<br>
<br>
                        <input style="width: 4rem; " class="cart-quantity-input" type="number" value="{{item.quantity}}">
                    </div>

                    <div style="flex:1">
                        <strong>Rs. {{item.total_price}}</strong>
                    </div>
                    <div style="flex:1">
                          <img class="chg-quantity remove_product" id="{{ item.product.id }}" src="{% static 'shop/cross.png' %}">
                    </div>

                </div>
                {% endfor %}
                <div class="text-right">
                    <strong>Subtotal: Rs. {{ subtotal }}</strong>
                </div>
        </div>
    {% else %}
        <strong class="text-center">The cart is empty</strong>
    {% endif %}
    </div>
            </div>
    </div>
</div>
{% endblock %}
{% block js %}
    <script>
  $('.remove_product').click(function(){
            let product_id = $(this).attr('id');

            $.ajax({
                url: '../remove-from-cart/',
                type: 'POST',
                data: {
                    product_id: product_id,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: () => {
                    alert('The product was deleted from cart!');
                    location.reload();  // Reload the page after deleting for cart updating},
                },
                error: message_from_server => console.error('An error occurred: ' + message_from_server)
            });
        });

    </script>
{% endblock %}